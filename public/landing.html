<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guerrero Guardianes - Portal de Confianza Ciudadana</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1e3a8a',
                        secondary: '#059669',
                        accent: '#d97706',
                        gold: '#fbbf24',
                        danger: '#e74c3c'
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(251, 191, 36, 0.5); }
            50% { box-shadow: 0 0 40px rgba(251, 191, 36, 0.8); }
        }
        .fade-in-up { animation: fadeInUp 0.8s ease-out forwards; }
        .pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
        .candidate-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .candidate-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }
        .candidate-card.selected {
            border: 3px solid var(--gold);
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.4);
        }
        .progress-bar { transition: width 1s ease-out; }
        .toast-notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease-out;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .toast-notification.show { transform: translateX(0); }
        .toast-notification.success { background-color: var(--secondary); }
        .toast-notification.error { background-color: var(--danger); }
        .toast-notification.info { background-color: var(--primary); }
        .security-slider { -webkit-appearance: none; appearance: none; }
        .security-slider::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 25px; height: 25px;
            background: var(--gold); cursor: pointer; border-radius: 50%;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-white to-emerald-50">

    <!-- HERO SECTION -->
    <section class="relative min-h-screen flex items-center justify-center overflow-hidden bg-gradient-to-br from-blue-900 via-blue-800 to-emerald-900">
        <div class="absolute inset-0 opacity-10" style="background-image: url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23ffffff" fill-opacity="1"%3E%3Cpath d="M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');"></div>
        </div>
        <div class="relative z-10 container mx-auto px-6 text-center">
            <div class="fade-in-up">
                <div class="inline-block mb-6"><span class="text-6xl">üõ°Ô∏è</span></div>
                <h1 class="text-5xl md:text-7xl font-bold text-white mb-6 leading-tight">Guerrero <span class="text-gold">Guardianes</span></h1>
                <p class="text-xl md:text-2xl text-blue-100 mb-4 max-w-3xl mx-auto">
                    Un sistema seguro y an√≥nimo para que la voz de los ciudadanos de Guerrero valide el proceso electoral de 2027.
                </p>
                <p class="text-lg text-blue-200 mb-12 max-w-2xl mx-auto">
                    üó≥Ô∏è Frente a la desconfianza, construimos una fuente de verdad colectiva.
                </p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
                    <button onclick="showAuthSection()" class="pulse-glow bg-gold hover:bg-yellow-500 text-blue-900 font-bold text-lg px-10 py-5 rounded-full transition-all duration-300 shadow-2xl">
                        üöÄ Unirse a la Validaci√≥n Ciudadana
                    </button>
                    <a href="#como-funciona" class="bg-white/10 hover:bg-white/20 text-white font-semibold px-8 py-5 rounded-full backdrop-blur-sm border-2 border-white/30 transition-all duration-300">
                        üìñ C√≥mo Funciona
                    </a>
                </div>
            </div>
        </div>
        <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 animate-bounce">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
        </div>
    </section>

    <!-- AUTHENTICATION SECTION (Initially Hidden) -->
    <section id="auth-section" class="hidden py-20 bg-white">
        <div class="container mx-auto px-6 max-w-2xl">
            <div class="bg-white rounded-2xl shadow-2xl p-8 border border-gray-200">
                <h2 class="text-3xl font-bold text-center text-blue-900 mb-2">Acceso Seguro y An√≥nimo</h2>
                <p class="text-center text-gray-600 mb-8">Tu identidad est√° protegida. Solo usaremos un hash de tu tel√©fono.</p>
                
                <div id="phone-form">
                    <div class="mb-4">
                        <label for="phone" class="block text-gray-700 font-bold mb-2">N√∫mero de tel√©fono (10 d√≠gitos)</label>
                        <input type="tel" id="phone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="7441234567" maxlength="10" inputmode="numeric">
                        <div id="phone-preview" class="mt-2 text-sm text-blue-600 font-semibold hidden"></div>
                    </div>
                    <button onclick="requestCode()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300">
                        Solicitar C√≥digo de Verificaci√≥n
                    </button>
                </div>

                <div id="code-form" class="hidden">
                    <div class="mb-4">
                        <label for="code" class="block text-gray-700 font-bold mb-2">C√≥digo de verificaci√≥n</label>
                        <input type="text" id="code" class="w-full px-4 py-3 text-center text-2xl border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="1234" maxlength="4" inputmode="numeric">
                        <p class="text-center text-gray-500 mt-2">C√≥digo enviado a: <strong id="sent-to-phone"></strong></p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="verifyCode()" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300">Verificar y Participar</button>
                        <button onclick="cancelVerification()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300">Cancelar</button>
                    </div>
                </div>
                <div id="message-auth"></div>
            </div>
        </div>
    </section>

    <!-- C√ìMO FUNCIONA -->
    <section id="como-funciona" class="py-20 bg-white">
        <div class="container mx-auto px-6">
            <div class="text-center mb-16">
                <h2 class="text-4xl md:text-5xl font-bold text-blue-900 mb-4">¬øC√≥mo Funciona?</h2>
                <p class="text-xl text-gray-600 max-w-2xl mx-auto">Un proceso de 4 pasos dise√±ado para garantizar la seguridad, el anonimato y la validez de tu voz.</p>
            </div>
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8 max-w-6xl mx-auto">
                <div class="text-center group">
                    <div class="bg-gradient-to-br from-blue-500 to-blue-700 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 text-white text-3xl font-bold shadow-xl group-hover:scale-110 transition-transform duration-300">1</div>
                    <h3 class="text-xl font-bold text-blue-900 mb-3">Verifica tu Identidad</h3>
                    <p class="text-gray-600">Usa tu tel√©fono para generar un identificador an√≥nimo. Tu n√∫mero nunca se almacena.</p>
                </div>
                <div class="text-center group">
                    <div class="bg-gradient-to-br from-emerald-500 to-emerald-700 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 text-white text-3xl font-bold shadow-xl group-hover:scale-110 transition-transform duration-300">2</div>
                    <h3 class="text-xl font-bold text-blue-900 mb-3">Elige y Mide tu Rigor</h3>
                    <p class="text-gray-600">Selecciona un candidato y usa el Slider de Seguridad para indicar tu nivel de certeza.</p>
                </div>
                <div class="text-center group">
                    <div class="bg-gradient-to-br from-amber-500 to-amber-700 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 text-white text-3xl font-bold shadow-xl group-hover:scale-110 transition-transform duration-300">3</div>
                    <h3 class="text-xl font-bold text-blue-900 mb-3">Env√≠a tu Voto</h3>
                    <p class="text-gray-600">Tu predicci√≥n se encripta y se registra de forma an√≥nima en nuestra base de datos segura.</p>
                </div>
                <div class="text-center group">
                    <div class="bg-gradient-to-br from-purple-500 to-purple-700 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 text-white text-3xl font-bold shadow-xl group-hover:scale-110 transition-transform duration-300">4</div>
                    <h3 class="text-xl font-bold text-blue-900 mb-3">Valida en Tiempo Real</h3>
                    <p class="text-gray-600">Observa c√≥mo tu voz se suma a la de miles de guerrerenses para crear una tendencia ciudadana.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- M√ìDULO DE ENCUESTA (For Authenticated Users) -->
    <section id="encuesta" class="hidden py-20 bg-gradient-to-br from-blue-50 to-emerald-50">
        <div class="container mx-auto px-6 max-w-7xl">
            <div class="text-center mb-12">
                <h2 class="text-4xl md:text-5xl font-bold text-blue-900 mb-4">üó≥Ô∏è Predicci√≥n Gubernatura 2027</h2>
                <p class="text-xl text-gray-600 mb-2">Tu voz, junto a la de miles, construye una visi√≥n m√°s clara de nuestro futuro.</p>
                <p class="text-sm text-gray-500">‚ö° 100% An√≥nimo ¬∑ Resultados en Tiempo Real</p>
            </div>
            <div id="survey-container">
                <div class="text-center py-12"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-900 mx-auto mb-4"></div><p class="text-gray-600">Cargando encuesta...</p></div>
            </div>
        </div>
    </section>

    <!-- RESULTADOS EN VIVO -->
    <section id="results" class="hidden py-20 bg-white">
        <div class="container mx-auto px-6 max-w-5xl">
            <div class="text-center mb-12">
                <h2 class="text-4xl md:text-5xl font-bold text-blue-900 mb-4">üìä Tendencia Ciudadana en Vivo</h2>
                <p class="text-xl text-gray-600">Predicciones de <span class="font-bold text-gold" id="total-votes">0</span> guardianes de Guerrero</p>
            </div>
            <div id="results-container" class="space-y-4">
                 <div class="text-center py-12"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-900 mx-auto mb-4"></div><p class="text-gray-600">Cargando resultados...</p></div>
            </div>
        </div>
    </section>

    <!-- FAQ, CTA, FOOTER sections remain the same as the original, as they are well-structured. -->
    <!-- ... (FAQ, CTA, FOOTER code from original) ... -->

    <script>
        // ========================================
        // GLOBAL STATE & CONFIG (Synchronized with index.html)
        // ========================================
        const API_BASE = window.location.hostname === 'localhost' ? 'http://localhost:3000/api' : `${window.location.protocol}//${window.location.host}/api`;
        
        class GlobalState {
            constructor() {
                this.state = { user: null, token: localStorage.getItem('authToken'), currentSurvey: null, results: {} };
                this.subscribers = [];
            }
            subscribe(callback) { this.subscribers.push(callback); }
            setState(newState) { this.state = { ...this.state, ...newState }; this.notify(); }
            notify() { this.subscribers.forEach(callback => callback(this.state)); }
            async fetchWithAuth(url, options = {}) {
                const defaultOptions = { headers: { 'Content-Type': 'application/json', ...(this.state.token && { 'Authorization': `Bearer ${this.state.token}` }) } };
                const response = await fetch(`${API_BASE}${url}`, { ...defaultOptions, ...options });
                if (response.status === 401) { this.logout(); return { error: 'Sesi√≥n expirada' }; }
                return await response.json();
            }
            logout() { this.state = { user: null, token: null, currentSurvey: null, results: {} }; localStorage.removeItem('authToken'); showLandingPage(); }
        }
        const appState = new GlobalState();
        appState.subscribe(updateUI);

        // ========================================
        // UI & NAVIGATION
        // ========================================
        function showAuthSection() { document.getElementById('auth-section').classList.remove('hidden'); document.getElementById('auth-section').scrollIntoView({ behavior: 'smooth' }); }
        function showLandingPage() {
            document.getElementById('auth-section').classList.add('hidden');
            document.getElementById('encuesta').classList.add('hidden');
            document.getElementById('results').classList.add('hidden');
        }
        function showAuthenticatedUI() {
            showAuthSection(); // Hide auth first
            document.getElementById('encuesta').classList.remove('hidden');
            document.getElementById('results').classList.remove('hidden');
            loadActiveSurvey();
        }
        function updateUI(state) {
            if (state.user) {
                // Could update a welcome message here if needed
            }
        }

        // ========================================
        // AUTHENTICATION FLOW (Integrated with backend)
        // ========================================
        document.getElementById('phone').addEventListener('input', (e) => {
            const value = e.target.value.replace(/\D/g, '').slice(0, 10);
            e.target.value = value;
            const preview = document.getElementById('phone-preview');
            if (value.length === 10) { preview.textContent = `Se enviar√° un c√≥digo a: +52 ${value.slice(0,3)} ${value.slice(3,6)} ${value.slice(6)}`; preview.classList.remove('hidden'); }
            else { preview.classList.add('hidden'); }
        });

        async function requestCode() {
            const phone = document.getElementById('phone').value.trim();
            if (!/^\d{10}$/.test(phone)) { showToast('Ingresa exactamente 10 d√≠gitos', 'error'); return; }
            try {
                const data = await appState.fetchWithAuth('/auth/request-code', { method: 'POST', body: JSON.stringify({ phone }) });
                if (data.success) {
                    document.getElementById('sent-to-phone').textContent = `+52 ${phone.slice(0,3)} ${phone.slice(3,6)} ${phone.slice(6)}`;
                    document.getElementById('phone-form').classList.add('hidden');
                    document.getElementById('code-form').classList.remove('hidden');
                    showToast(data.code ? `C√≥digo (DEV): ${data.code}` : 'C√≥digo enviado por SMS', 'success');
                } else { showToast(data.error || 'Error al solicitar c√≥digo', 'error'); }
            } catch (error) { showToast('Error de conexi√≥n', 'error'); }
        }

        async function verifyCode() {
            const phone = document.getElementById('phone').value.trim();
            const code = document.getElementById('code').value.trim();
            if (!code || code.length !== 4) { showToast('C√≥digo debe ser de 4 d√≠gitos', 'error'); return; }
            try {
                const data = await appState.fetchWithAuth('/auth/verify-code', { method: 'POST', body: JSON.stringify({ phone, code }) });
                if (data.success) {
                    appState.setState({ token: data.token, user: data.user });
                    localStorage.setItem('authToken', data.token);
                    showToast('¬°Verificaci√≥n exitosa! Bienvenido, Guardian.', 'success');
                    setTimeout(showAuthenticatedUI, 1000);
                } else { showToast(data.error || 'C√≥digo incorrecto', 'error'); }
            } catch (error) { showToast('Error de conexi√≥n', 'error'); }
        }
        function cancelVerification() {
            document.getElementById('phone-form').classList.remove('hidden');
            document.getElementById('code-form').classList.add('hidden');
            document.getElementById('code').value = '';
            document.getElementById('phone-preview').classList.add('hidden');
        }

        // ========================================
        // SURVEY & RESULTS (Real-time API integration)
        // ========================================
        let selectedCandidate = null;
        let securityLevel = 75; // Default for the "Security Slider"

        async function loadActiveSurvey() {
            const container = document.getElementById('survey-container');
            container.innerHTML = '<div class="text-center py-12"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-900 mx-auto mb-4"></div><p class="text-gray-600">Cargando encuesta...</p></div>';
            try {
                const data = await appState.fetchWithAuth('/surveys/active');
                if (data.success && data.surveys.length > 0) {
                    const survey = data.surveys[0];
                    appState.setState({ currentSurvey: survey });
                    renderSurvey(survey);
                    await loadSurveyResults(survey.id); // Load initial results
                } else {
                    container.innerHTML = `<div class="text-center py-12 bg-yellow-50 rounded-lg border-2 border-yellow-200"><p class="text-yellow-800">No hay encuestas activas en este momento.</p></div>`;
                }
            } catch (error) { container.innerHTML = `<div class="text-center py-12 bg-red-50 rounded-lg border-2 border-red-200"><p class="text-red-600">Error al cargar la encuesta.</p></div>`; }
        }
        
        function renderSurvey(survey) {
            const container = document.getElementById('survey-container');
            // Assuming the first question is the candidate choice, and second is the security slider
            const candidateQuestion = survey.questions[0];
            const securityQuestion = survey.questions[1];

            let html = `<div class="bg-white rounded-2xl shadow-2xl p-8"><h3 class="text-2xl font-bold text-blue-900 mb-6">${survey.title}</h3>`;
            
            // Render Candidate Selection
            html += `<div class="mb-8"><h4 class="text-lg font-semibold mb-4">${candidateQuestion.questionText}</h4><div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">`;
            candidateQuestion.options.forEach(opt => {
                html += `
                    <div class="candidate-card bg-white rounded-xl p-6 shadow-lg border-2 border-gray-200" onclick="selectCandidate('${opt.value}', '${opt.label}')">
                        <h5 class="font-bold text-center">${opt.label}</h5>
                    </div>`;
            });
            html += `</div></div>`;

            // Render Security Slider
            html += `
                <div id="security-section" class="hidden">
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
                        <p class="text-sm text-gray-700"><strong>Seleccionaste:</strong> <span id="selected-candidate-name"></span></p>
                    </div>
                    <h4 class="text-lg font-semibold mb-4">${securityQuestion.questionText}</h4>
                    <div class="mb-4">
                        <input type="range" id="security-slider" min="50" max="100" value="75" step="25" class="security-slider w-full" oninput="updateSecurityLevel(this.value)">
                        <div class="flex justify-between mt-2 text-sm font-semibold">
                            <span class="text-gray-500">50% (Indeciso)</span>
                            <span class="text-blue-600">75% (Probable)</span>
                            <span class="text-emerald-600">100% (Seguro)</span>
                        </div>
                    </div>
                    <div class="text-center mb-6">
                        <div class="text-5xl font-bold text-gold mb-2" id="security-display">75%</div>
                        <div class="text-gray-600" id="security-label">Nivel de Rigor: Probable</div>
                    </div>
                    <button onclick="submitVote()" class="w-full bg-gold hover:bg-yellow-500 text-blue-900 font-bold text-lg py-4 rounded-xl shadow-lg transition-all duration-300 hover:scale-105">
                        ‚úÖ Enviar Mi Predicci√≥n
                    </button>
                </div>
            `;
            container.innerHTML = html + `</div>`;
        }

        function selectCandidate(value, label) {
            document.querySelectorAll('.candidate-card').forEach(card => card.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            selectedCandidate = value;
            document.getElementById('selected-candidate-name').textContent = label;
            document.getElementById('security-section').classList.remove('hidden');
            document.getElementById('security-section').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function updateSecurityLevel(value) {
            securityLevel = parseInt(value);
            document.getElementById('security-display').textContent = securityLevel + '%';
            let label = 'Indeciso';
            if (securityLevel === 75) label = 'Probable';
            else if (securityLevel === 100) label = 'Seguro';
            document.getElementById('security-label').textContent = `Nivel de Rigor: ${label}`;
        }

        async function submitVote() {
            if (!selectedCandidate || !appState.state.currentSurvey) { showToast('Por favor, completa todos los pasos', 'error'); return; }
            const survey = appState.state.currentSurvey;
            const responses = [
                { questionId: survey.questions[0].id, answer: selectedCandidate },
                { questionId: survey.questions[1].id, answer: securityLevel.toString() }
            ];
            try {
                const data = await appState.fetchWithAuth(`/surveys/${survey.id}/response`, {
                    method: 'POST',
                    body: JSON.stringify({ responses })
                });
                if (data.success) {
                    showToast('¬°Predicci√≥n enviada con √©xito!', 'success');
                    // Reset UI
                    document.getElementById('security-section').classList.add('hidden');
                    document.querySelectorAll('.candidate-card').forEach(card => card.classList.remove('selected'));
                    selectedCandidate = null;
                    // Refresh results
                    await loadSurveyResults(survey.id);
                    document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
                } else { showToast(data.error || 'Error al enviar tu voto', 'error'); }
            } catch (error) { showToast('Error de conexi√≥n', 'error'); }
        }

        async function loadSurveyResults(surveyId) {
            const container = document.getElementById('results-container');
            try {
                const data = await appState.fetchWithAuth(`/surveys/${surveyId}/results`);
                if (data.success) {
                    renderResults(data.results);
                    appState.setState({ results: { ...appState.state.results, [surveyId]: data } });
                }
            } catch (error) { container.innerHTML = `<p class="text-red-500 text-center">Error al cargar resultados.</p>`; }
        }

        function renderResults(results) {
            const container = document.getElementById('results-container');
            if (!results || results.length === 0) { container.innerHTML = `<p class="text-gray-500 text-center">A√∫n no hay resultados.</p>`; return; }
            
            let html = '';
            let totalVotes = 0;
            results.forEach(r => totalVotes += r.responses.reduce((sum, res) => sum + res.count, 0));
            document.getElementById('total-votes').textContent = totalVotes.toLocaleString();

            results.forEach(question => {
                html += `<div class="bg-white rounded-xl p-6 shadow-lg mb-4"><h4 class="font-bold text-lg mb-4">${question.questionText}</h4>`;
                question.responses.forEach(res => {
                    const percentage = totalVotes > 0 ? (res.count / totalVotes * 100).toFixed(1) : 0;
                    html += `
                        <div class="mb-3">
                            <div class="flex justify-between mb-1"><span>${res.value}</span><span>${percentage}% (${res.count} votos)</span></div>
                            <div class="w-full bg-gray-200 rounded-full h-3"><div class="bg-gold h-3 rounded-full" style="width: ${percentage}%"></div></div>
                        </div>`;
                });
                html += `</div>`;
            });
            container.innerHTML = html;
        }
        
        // ========================================
        // UTILITIES
        // ========================================
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast-notification ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => { toast.classList.remove('show'); setTimeout(() => document.body.removeChild(toast), 300); }, 3000);
        }

        function toggleFAQ(num) { /* ... same as original ... */ }

        // ========================================
        // INITIALIZATION
        // ========================================
        document.addEventListener('DOMContentLoaded', async () => {
            // Check for existing token
            if (appState.state.token) {
                try {
                    const data = await appState.fetchWithAuth('/auth/me');
                    if (data.user) {
                        appState.setState({ user: data.user });
                        showAuthenticatedUI();
                    } else {
                        appState.logout();
                    }
                } catch (error) {
                    appState.logout();
                }
            }
        });
    </script>
    <!-- Include FAQ, CTA, and Footer from the original file -->
</body>
</html>